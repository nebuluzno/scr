<div class="container fade-in">
  <div class="page-header">
    <h1>ğŸ“Š LLM Metrics</h1>
    <p class="subtitle">Track usage, costs, and performance</p>
  </div>
  
  <div class="metrics-section">
    <h2>ğŸ“ˆ Usage Overview</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-value"><%= @metrics_stats.total_calls %></div>
        <div class="stat-label">Total Calls</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-value"><%= format_number(@metrics_stats.total_prompt_tokens) %></div>
        <div class="stat-label">Prompt Tokens</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âœ¨</div>
        <div class="stat-value"><%= format_number(@metrics_stats.total_completion_tokens) %></div>
        <div class="stat-label">Completion Tokens</div>
      </div>
      <div class="stat-card highlight">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-value">$<%= :erlang.float_to_binary(@metrics_stats.total_cost, [{:decimals, 4}]) %></div>
        <div class="stat-label">Total Cost</div>
      </div>
    </div>
  </div>
  
  <div class="metrics-section">
    <h2>ğŸ’¾ Cache Performance</h2>
    <div class="cache-grid">
      <div class="cache-stats card">
        <div class="cache-header">
          <h3>Cache Status</h3>
          <span class={"badge #{if @cache_stats.enabled, do: "badge-success", else: "badge-error"}"}>
            <%= if @cache_stats.enabled, do: "â— Active", else: "â—‹ Disabled" %>
          </span>
        </div>
        <div class="cache-metrics">
          <div class="cache-metric">
            <span class="metric-value"><%= @cache_stats.size %></span>
            <span class="metric-label">Cached Items</span>
          </div>
          <div class="cache-metric">
            <span class="metric-value"><%= @cache_stats.hits %></span>
            <span class="metric-label">Cache Hits</span>
          </div>
          <div class="cache-metric">
            <span class="metric-value"><%= @cache_stats.misses %></span>
            <span class="metric-label">Cache Misses</span>
          </div>
        </div>
        <%= if @cache_stats.hits + @cache_stats.misses > 0 do %>
          <% hit_rate = @cache_stats.hits / (@cache_stats.hits + @cache_stats.misses) * 100 %>
          <div class="cache-rate">
            <span class="rate-label">Hit Rate</span>
            <div class="rate-bar">
              <div class="rate-fill" style={"width: #{hit_rate}%"}></div>
            </div>
            <span class="rate-value"><%= Float.round(hit_rate, 1) %>%</span>
          </div>
        <% end %>
      </div>
      
      <div class="cache-benefits card">
        <h3>ğŸ’¡ Cache Benefits</h3>
        <ul>
          <li>
            <span class="benefit-icon">âš¡</span>
            <span>Faster response times for repeated queries</span>
          </li>
          <li>
            <span class="benefit-icon">ğŸ’µ</span>
            <span>Reduced API costs by avoiding duplicate calls</span>
          </li>
          <li>
            <span class="benefit-icon">ğŸ”„</span>
            <span>Consistent responses for identical prompts</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="metrics-section">
    <h2>ğŸ“Š Token Usage</h2>
    <% total_tokens = @metrics_stats.total_prompt_tokens + @metrics_stats.total_completion_tokens %>
    <div class="usage-chart card">
      <div class="chart-header">
        <div class="chart-legend">
          <span class="legend-item"><span class="legend-color prompt"></span> Prompt Tokens</span>
          <span class="legend-item"><span class="legend-color completion"></span> Completion Tokens</span>
        </div>
      </div>
      <div class="chart-bars">
        <div class="bar-group">
          <div class="bar-label">Total</div>
          <div class="bars">
            <% prompt_pct = if total_tokens > 0, do: @metrics_stats.total_prompt_tokens / total_tokens * 100, else: 0 %>
            <% completion_pct = if total_tokens > 0, do: @metrics_stats.total_completion_tokens / total_tokens * 100, else: 0 %>
            <div class="bar prompt" style={"width: #{prompt_pct}%"}>
              <%= format_number(@metrics_stats.total_prompt_tokens) %>
            </div>
            <div class="bar completion" style={"width: #{completion_pct}%"}>
              <%= format_number(@metrics_stats.total_completion_tokens) %>
            </div>
          </div>
        </div>
      </div>
      <div class="chart-summary">
        <span>Total: <%= format_number(total_tokens) %> tokens</span>
      </div>
    </div>
  </div>
  
  <div class="actions-bar">
    <a href="/" class="btn btn-secondary">â† Back to Dashboard</a>
  </div>
</div>

