<div class="container fade-in">
  <div class="page-header">
    <h1>üìä LLM Metrics</h1>
    <p class="subtitle">Track usage, costs, and performance</p>
  </div>
  
  <div class="metrics-section">
    <h2>üìà Usage Overview</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üìû</div>
        <div class="stat-value"><%= @metrics_stats.total_calls %></div>
        <div class="stat-label">Total Calls</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìù</div>
        <div class="stat-value"><%= format_number(@metrics_stats.total_prompt_tokens) %></div>
        <div class="stat-label">Prompt Tokens</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">‚ú®</div>
        <div class="stat-value"><%= format_number(@metrics_stats.total_completion_tokens) %></div>
        <div class="stat-label">Completion Tokens</div>
      </div>
      <div class="stat-card highlight">
        <div class="stat-icon">üí∞</div>
        <div class="stat-value">$<%= :erlang.float_to_binary(@metrics_stats.total_cost, [{:decimals, 4}]) %></div>
        <div class="stat-label">Total Cost</div>
      </div>
    </div>
  </div>
  
  <div class="metrics-section">
    <h2>üíæ Cache Performance</h2>
    <div class="cache-grid">
      <div class="cache-stats card">
        <div class="cache-header">
          <h3>Cache Status</h3>
          <span class={"badge #{if @cache_stats.enabled, do: "badge-success", else: "badge-error"}"}>
            <%= if @cache_stats.enabled, do: "‚óè Active", else: "‚óã Disabled" %>
          </span>
        </div>
        <div class="cache-metrics">
          <div class="cache-metric">
            <span class="metric-value"><%= @cache_stats.size %></span>
            <span class="metric-label">Cached Items</span>
          </div>
          <div class="cache-metric">
            <span class="metric-value"><%= @cache_stats.hits %></span>
            <span class="metric-label">Cache Hits</span>
          </div>
          <div class="cache-metric">
            <span class="metric-value"><%= @cache_stats.misses %></span>
            <span class="metric-label">Cache Misses</span>
          </div>
        </div>
        <%= if @cache_stats.hits + @cache_stats.misses > 0 do %>
          <% hit_rate = @cache_stats.hits / (@cache_stats.hits + @cache_stats.misses) * 100 %>
          <div class="cache-rate">
            <span class="rate-label">Hit Rate</span>
            <div class="rate-bar">
              <div class="rate-fill" style={"width: #{hit_rate}%"}></div>
            </div>
            <span class="rate-value"><%= Float.round(hit_rate, 1) %>%</span>
          </div>
        <% end %>
      </div>
      
      <div class="cache-benefits card">
        <h3>üí° Cache Benefits</h3>
        <ul>
          <li>
            <span class="benefit-icon">‚ö°</span>
            <span>Faster response times for repeated queries</span>
          </li>
          <li>
            <span class="benefit-icon">üíµ</span>
            <span>Reduced API costs by avoiding duplicate calls</span>
          </li>
          <li>
            <span class="benefit-icon">üîÑ</span>
            <span>Consistent responses for identical prompts</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="metrics-section">
    <h2>üìä Token Usage</h2>
    <% total_tokens = @metrics_stats.total_prompt_tokens + @metrics_stats.total_completion_tokens %>
    <div class="usage-chart card">
      <div class="chart-header">
        <div class="chart-legend">
          <span class="legend-item"><span class="legend-color prompt"></span> Prompt Tokens</span>
          <span class="legend-item"><span class="legend-color completion"></span> Completion Tokens</span>
        </div>
      </div>
      <div class="chart-bars">
        <div class="bar-group">
          <div class="bar-label">Total</div>
          <div class="bars">
            <% prompt_pct = if total_tokens > 0, do: @metrics_stats.total_prompt_tokens / total_tokens * 100, else: 0 %>
            <% completion_pct = if total_tokens > 0, do: @metrics_stats.total_completion_tokens / total_tokens * 100, else: 0 %>
            <div class="bar prompt" style={"width: #{prompt_pct}%"}>
              <%= format_number(@metrics_stats.total_prompt_tokens) %>
            </div>
            <div class="bar completion" style={"width: #{completion_pct}%"}>
              <%= format_number(@metrics_stats.total_completion_tokens) %>
            </div>
          </div>
        </div>
      </div>
      <div class="chart-summary">
        <span>Total: <%= format_number(total_tokens) %> tokens</span>
      </div>
    </div>
  </div>
  
  <div class="actions-bar">
    <a href="/" class="btn btn-secondary">‚Üê Back to Dashboard</a>
  </div>
</div>

<style>
.page-header {
  text-align: center;
  margin-bottom: 2rem;
}

.page-header h1 {
  font-size: 2rem;
}

.metrics-section {
  margin-bottom: 2rem;
}

.metrics-section h2 {
  font-size: 1.25rem;
  margin-bottom: 1rem;
  color: var(--text-secondary);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 1rem;
}

.stat-card {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 1.5rem;
  text-align: center;
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-4px);
  border-color: var(--primary-color);
}

.stat-card.highlight {
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
  border-color: var(--primary-color);
}

.stat-icon {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
}

.stat-value {
  font-size: 1.75rem;
  font-weight: 800;
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.stat-label {
  color: var(--text-secondary);
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

.cache-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.cache-stats {
  padding: 1.5rem;
}

.cache-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.cache-header h3 {
  margin: 0;
}

.cache-metrics {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.cache-metric {
  text-align: center;
}

.metric-value {
  display: block;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-color);
}

.metric-label {
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.cache-rate {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.rate-label {
  font-size: 0.875rem;
  color: var(--text-secondary);
  min-width: 70px;
}

.rate-bar {
  flex: 1;
  height: 8px;
  background: var(--bg-color);
  border-radius: 4px;
  overflow: hidden;
}

.rate-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--success-color), #4ade80);
  border-radius: 4px;
  transition: width 0.5s ease;
}

.rate-value {
  font-weight: 600;
  color: var(--success-color);
  min-width: 50px;
  text-align: right;
}

.cache-benefits {
  padding: 1.5rem;
}

.cache-benefits h3 {
  margin: 0 0 1rem 0;
}

.cache-benefits ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.cache-benefits li {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--border-color);
}

.cache-benefits li:last-child {
  border-bottom: none;
}

.benefit-icon {
  font-size: 1.25rem;
}

.usage-chart {
  padding: 1.5rem;
}

.chart-header {
  margin-bottom: 1.5rem;
}

.chart-legend {
  display: flex;
  gap: 1.5rem;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.legend-color {
  width: 12px;
  height: 12px;
  border-radius: 3px;
}

.legend-color.prompt {
  background: var(--primary-color);
}

.legend-color.completion {
  background: var(--success-color);
}

.chart-bars {
  margin-bottom: 1rem;
}

.bar-group {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.bar-label {
  min-width: 60px;
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.bars {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.bar {
  height: 32px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  padding: 0 1rem;
  font-size: 0.8rem;
  font-weight: 600;
  color: white;
  min-width: fit-content;
  transition: width 0.5s ease;
}

.bar.prompt {
  background: linear-gradient(90deg, var(--primary-color), #818cf8);
}

.bar.completion {
  background: linear-gradient(90deg, var(--success-color), #4ade80);
}

.chart-summary {
  text-align: center;
  padding-top: 1rem;
  border-top: 1px solid var(--border-color);
  color: var(--text-secondary);
  font-size: 0.875rem;
}

.actions-bar {
  display: flex;
  justify-content: center;
  margin-top: 2rem;
}

@media (max-width: 768px) {
  .cache-grid {
    grid-template-columns: 1fr;
  }
  
  .cache-metrics {
    grid-template-columns: 1fr;
  }
}
</style>
